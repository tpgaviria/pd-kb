{"data":{"mdx":{"id":"7975c7f1-9d52-5327-9d65-9e14541309aa","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Zabbix Troubleshooting Guide\",\n  \"slug\": \"zabbix-troubleshooting-guide\",\n  \"hidden\": false,\n  \"createdAt\": \"2017-05-17T22:24:11.434Z\",\n  \"updatedAt\": \"2018-02-10T01:01:58.371Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Below are some common issues that you may run into when trying to integrate Zabbix with PagerDuty and steps for troubleshooting those problems. \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#section-potential-issues-within-the-zabbix-configuration\"\n  }), \"Potential Issues within the Zabbix Configuration\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#section-troubleshooting-issues-with-the-agent-based-integration\"\n  }), \"Troubleshooting Issues with the Agent-based Integration\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#section-troubleshooting-issues-with-the-python-based-integration\"\n  }), \"Troubleshooting Issues with the Python-based Integration\"), \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Potential Issues within the Zabbix Configuration\\\"\\n}\\n\", \"[/block]\", \"\\nCheck whether Zabbix has attempted to send an event to PagerDuty by viewing your Zabbix logs. Make sure the PagerDuty action was called, and if there were any errors in doing so.\")), mdx(\"p\", null, \"For Zabbix 2.x: navigate go to \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Monitoring \\u2192 Events\"), \", then click the event timestamp for the problem event. Check the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Message actions\"), \" section in the event details.\\nFor Zabbix 3.x: navigate to \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Reports \\u2192 Action Log\"), \" to view the Status of the Zabbix event.\"), mdx(\"p\", null, \"##Events are not being sent to the PagerDuty user/action\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Make sure the PagerDuty group in Zabbix has read permissions for the hosts and/or host groups in question. Also confirm that the PagerDuty user is in the PagerDuty group.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Check that the PagerDuty media type is enabled in \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Configuration \\u2192 Media types\"), \".\")), mdx(\"p\", null, \"##Events appear to be sent to the PagerDuty user/action, but aren't showing up in PagerDuty\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Both the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"zabbix-agent\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"zabbix-server\"), \" services must be running for Zabbix to send notifications to PagerDuty. The check that these are running use the following commands:\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"service zabbix-agent status\\nservice zabbix-server status\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Make sure your Zabbix server can make outbound HTTP/HTTPS connections to events.pagerduty.com on ports 80 and 443. If your environment requires a proxy to be set for outbound HTTP/HTTPS connections, make sure you \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide/#Proxy\"\n  }), \"set the proxy in the agent configuration\"), \" or see the information below for \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#section-troubleshooting-issues-with-the-python-based-integration\"\n  }), \"using a proxy with the old Python integration\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Check that the integration key is set correctly in your PagerDuty user's media settings.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you see an error such as \\\"pagerduty_python: PagerDuty server REJECTED the event in file...Event object is invalid,\\\" check the trigger and recovery subjects and message formats in your PagerDuty action.\")), mdx(\"p\", null, \"Under \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Configuration \\u2192 Actions\"), \", select the PagerDuty notification action to view its details. Remove any extra characters, such as whitespace or a newline-character after the text so that the configuration matches this exactly:\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Default subject\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"trigger\"), \"\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Recovery subject\"), \": \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"resolve\"), \"\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Default message\"), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Recovery message\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"name:{TRIGGER.NAME}\\nid:{TRIGGER.ID}\\nstatus:{TRIGGER.STATUS}\\nhostname:{HOSTNAME}\\nip:{IPADDRESS}\\nvalue:{TRIGGER.VALUE}\\nevent_id:{EVENT.ID}\\nseverity:{TRIGGER.SEVERITY}\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you're using Zabbix 3.x, make sure you have specified these script parameters for the PagerDuty media type under Administration \\u2192 Media types:\", mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"- {ALERT.SENDTO}\\n- {ALERT.SUBJECT}\\n- {ALERT.MESSAGE}\\n\")), \"[block:image]\", \"\\n{\\n\\\"images\\\": [\\n{\\n\\\"image\\\": \", \"[\\n\\\"https://files.readme.io/50d6592-ZabbixTroubleshooting_img2.png\\\",\\n\\\"ZabbixTroubleshooting_img2.png\\\",\\n776,\\n489,\\n\\\"#124c76\\\"\\n]\", \"\\n}\\n]\\n}\\n\", \"[/block]\", \"\\n##Incidents are being triggered in PagerDuty, but they are not being resolved automatically after recovering in Zabbix\")), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Ensure that your \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"PagerDuty Notifications\"), \" action has messaging operations (send to user / group) defined for its \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Recovery operations\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Make sure that the messaging operations configured for the PagerDuty Notifications action have the same message template for the main action as for the recovery action\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Make sure the message template is the one given in the integration guide for your Zabbix integration: \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/zabbix-integration-guide/\"\n  }), \"Zabbix Integration Guide\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/zabbix-3-integration-guide/\"\n  }), \"Zabbix 3 Integration Guide\"), \" (also produced above; see \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#section-potential-issues-within-the-zabbix-configuration\"\n  }), \"Potential Issues Within the Zabbix Configuration\"), \").\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Ensure that the recovery operations' default message subject is \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"resolve\"), \", verbatim (it is case sensitive)\\n\", \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Troubleshooting Issues with the Agent-based Integration\\\"\\n}\\n\", \"[/block]\", \"\\n##Verify the Agent is Installed\\nThe most common problem we see when we begin troubleshooting agent integrations is that the agent has not been installed successfully (i.e. trying to install on an incompatible distribution like CentOS 5). The first step in troubleshooting Agent-based integrations is to make sure that the PagerDuty Agent is both compatible with your distribution and successfully installed by following the steps in our Agent Install Guide.\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"CentOS 5 users\"), \": You will need to use the older \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/zabbix-integration-guide-agentless/\"\n  }), \"Python-based integration\"), \", as the PagerDuty Agent requires a newer version of Python than the version available with CentOS 5.\"), mdx(\"p\", null, \"##Verify the Agent is Running\\nOnce you've verified the agent has been successfully installed, you'll want to make sure that it is running. You can check the status by running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"service pdagent status\"), \". If the agent isn't running, you can start it with the command \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"service pdagent start\"), \".\"), mdx(\"p\", null, \"##Check the Agent's Logs for Errors\\nThe agent logs activity and errors to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/var/log/pdagent/pdagentd.log\"), \", which may contain information helpful in troubleshooting problems with the integration.\"), mdx(\"p\", null, \"##Trigger a Test Incident with the Agent's CLI\\nTry manually triggering an incident using the pd-send command and check for errors (set \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PD_SERVICE_KEY\"), \" to your own PagerDuty integration key):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ export PD_SERVICE_KEY=65d9cd0e14c04dae8ef86867277d138c\\n$ pd-send -k $PD_SERVICE_KEY -t trigger -d \\\"Server is on fire\\\" -i server.fire\\n\")), mdx(\"p\", null, \"If an incident is triggered in PagerDuty, check the tips in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"#section-potential-issues-within-the-zabbix-configuration\"\n  }), \"Potential Issues within your Zabbix Configuration\"), \" section. You may need to verify the trigger subject and message in your Zabbix configuration.\"), mdx(\"p\", null, \"##Trigger a Test Incident with pd-zabbix\\nTry manually triggering an incident using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pd-zabbix\"), \" command and check for errors (set \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PD_SERVICE_KEY\"), \" to your own PagerDuty integration key):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"/usr/share/pdagent-integrations/bin/pd-zabbix PD_SERVICE_KEY trigger \\\"name:Test\\nid:1\\nstatus:onfire\\nhostname:localhost\\nip:127.0.0.1\\nvalue:5\\nevent_id:2\\nseverity:1\\\"\\n\")), mdx(\"p\", null, \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Troubleshooting Issues with the Python-based Integration\\\"\\n}\\n\", \"[/block]\", \"\\n##Make Sure you have Python 2.7.9 or Newer\\nAlthough the Python script was previously tested with Python 2.6, it now requires version 2.7.9 to make a secure connection to PagerDuty. This changed because SSLv3 is no longer enabled on our web servers due to the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/POODLE\"\n  }), \"POODLE vulnerability\"), \", and older versions of Python try to use SSLv3. Python 2.7.9 uses a backported version of Python 3's SSL library, so versions 2.7.9 and newer (up to 3.x) are able to make a secure connection to PagerDuty. The script also does not work with Python 3.x due to other language changes in this version of Python.\"), mdx(\"p\", null, \"##Does your Environment Require a Proxy to be set for Outbound HTTP/HTTPS Connections?\\nIf you need to set a proxy, use this modified version of the Python script for proxy support. Replace \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SOME_PROXY\"), \" on line 68 with your proxy address (i.e. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://proxy.company.com:3128\"), \").\"), mdx(\"p\", null, \"##Trigger a Test Incident with the pagerduty.py Script\\nTry manually triggering an incident with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pagerduty.py\"), \" via the command line and check for errors (set \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PD_SERVICE_KEY\"), \" to your own PagerDuty integration key):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"/etc/zabbix/alert.d/pagerduty.py PD_SERVICE_KEY trigger \\\"name:Test\\nid:1\\nstatus:onfire\\nhostname:localhost\\nip:127.0.0.1\\nvalue:5\\nevent_id:2\\nseverity:1\\\"\\n\")), mdx(\"p\", null, \"##Verify the Python Script is in the Correct Location\\nThe script should be placed in your \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"AlertScriptsPath\"), \". This is usually \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/usr/lib/zabbix/alertscripts\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/etc/zabbix/agent.d\"), \", but could be different if you installed Zabbix from non-standard packages. You can find the correct path for your particular environment by checking \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"zabbix_server.conf\"), \" in your Zabbix server configuration directory.\"), mdx(\"p\", null, \"##Verify the Zabbix User has Write Permissions\\nThe script queues events in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/tmp/pagerduty\"), \", so if the Zabbix user can't write to this directory it won't be able to send alerts to PagerDuty.\"));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{},"frontmatter":{"title":"Zabbix Troubleshooting Guide"}}},"pageContext":{"id":"7975c7f1-9d52-5327-9d65-9e14541309aa"}}