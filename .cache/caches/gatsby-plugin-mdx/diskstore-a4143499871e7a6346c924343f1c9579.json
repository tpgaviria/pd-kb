{"expireTime":9007200861686578000,"key":"gatsby-plugin-mdx-entire-payload-f8b875622163f69bcfcb7f3dd07015dc-","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"PagerDuty Agent is an open-source utility for integrating standalone / on-premise monitoring tools with PagerDuty.\n","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":2,"column":1,"offset":115},"indent":[1]}},{"type":"linkReference","identifier":"block:api-header","label":"block:api-header","referenceType":"shortcut","children":[{"type":"text","value":"block:api-header","position":{"start":{"line":2,"column":2,"offset":116},"end":{"line":2,"column":18,"offset":132},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":115},"end":{"line":2,"column":19,"offset":133},"indent":[]}},{"type":"text","value":"\n{\n  \"title\": \"First Steps\"\n}\n","position":{"start":{"line":2,"column":19,"offset":133},"end":{"line":6,"column":1,"offset":163},"indent":[1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":6,"column":2,"offset":164},"end":{"line":6,"column":8,"offset":170},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":163},"end":{"line":6,"column":9,"offset":171},"indent":[]}},{"type":"text","value":"\nIf you have trouble sending events to PagerDuty using the agent, run the following checks:","position":{"start":{"line":6,"column":9,"offset":171},"end":{"line":7,"column":91,"offset":262},"indent":[1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":7,"column":91,"offset":262},"indent":[1,1,1,1,1,1]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"link","title":null,"url":"https://www.pagerduty.com/docs/guides/agent-install-guide#VerifyAgentRunning","children":[{"type":"text","value":"Verify that the ","position":{"start":{"line":9,"column":6,"offset":269},"end":{"line":9,"column":22,"offset":285},"indent":[]}},{"type":"inlineCode","value":"pdagent","position":{"start":{"line":9,"column":22,"offset":285},"end":{"line":9,"column":31,"offset":294},"indent":[]}},{"type":"text","value":" service is running.","position":{"start":{"line":9,"column":31,"offset":294},"end":{"line":9,"column":51,"offset":314},"indent":[]}}],"position":{"start":{"line":9,"column":5,"offset":268},"end":{"line":9,"column":130,"offset":393},"indent":[]}}],"position":{"start":{"line":9,"column":3,"offset":266},"end":{"line":9,"column":132,"offset":395},"indent":[]}},{"type":"text","value":" If the service is not running, you can start it with the command ","position":{"start":{"line":9,"column":132,"offset":395},"end":{"line":9,"column":198,"offset":461},"indent":[]}},{"type":"inlineCode","value":"systemctl start pdagent","position":{"start":{"line":9,"column":198,"offset":461},"end":{"line":9,"column":223,"offset":486},"indent":[]}},{"type":"text","value":" (on systemd-based systems) or ","position":{"start":{"line":9,"column":223,"offset":486},"end":{"line":9,"column":254,"offset":517},"indent":[]}},{"type":"inlineCode","value":"sudo service pdagent start","position":{"start":{"line":9,"column":254,"offset":517},"end":{"line":9,"column":282,"offset":545},"indent":[]}},{"type":"text","value":" (on SysV init-based systems). Any events that were enqueued while the service was stopped will be sent when the service starts.","position":{"start":{"line":9,"column":282,"offset":545},"end":{"line":9,"column":410,"offset":673},"indent":[]}}],"position":{"start":{"line":9,"column":3,"offset":266},"end":{"line":9,"column":410,"offset":673},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":264},"end":{"line":9,"column":410,"offset":673},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Check the service integration key:","position":{"start":{"line":10,"column":5,"offset":678},"end":{"line":10,"column":39,"offset":712},"indent":[]}}],"position":{"start":{"line":10,"column":3,"offset":676},"end":{"line":10,"column":41,"offset":714},"indent":[]}},{"type":"text","value":" make sure that the key is for the correct service and that it has been entered correctly.","position":{"start":{"line":10,"column":41,"offset":714},"end":{"line":10,"column":131,"offset":804},"indent":[]}}],"position":{"start":{"line":10,"column":3,"offset":676},"end":{"line":10,"column":131,"offset":804},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":674},"end":{"line":10,"column":131,"offset":804},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Send a test event","position":{"start":{"line":11,"column":5,"offset":809},"end":{"line":11,"column":22,"offset":826},"indent":[]}}],"position":{"start":{"line":11,"column":3,"offset":807},"end":{"line":11,"column":24,"offset":828},"indent":[]}},{"type":"text","value":" using ","position":{"start":{"line":11,"column":24,"offset":828},"end":{"line":11,"column":31,"offset":835},"indent":[]}},{"type":"inlineCode","value":"pd-send","position":{"start":{"line":11,"column":31,"offset":835},"end":{"line":11,"column":40,"offset":844},"indent":[]}},{"type":"text","value":" as shown in ","position":{"start":{"line":11,"column":40,"offset":844},"end":{"line":11,"column":53,"offset":857},"indent":[]}},{"type":"link","title":null,"url":"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-send","children":[{"type":"text","value":"Sending an Event to PagerDuty","position":{"start":{"line":11,"column":54,"offset":858},"end":{"line":11,"column":83,"offset":887},"indent":[]}}],"position":{"start":{"line":11,"column":53,"offset":857},"end":{"line":11,"column":151,"offset":955},"indent":[]}},{"type":"text","value":". Remember to replace the key used in the example with your own PagerDuty Service Integration Key.","position":{"start":{"line":11,"column":151,"offset":955},"end":{"line":11,"column":249,"offset":1053},"indent":[]}}],"position":{"start":{"line":11,"column":3,"offset":807},"end":{"line":11,"column":249,"offset":1053},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":805},"end":{"line":11,"column":249,"offset":1053},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Check the logs","position":{"start":{"line":12,"column":5,"offset":1058},"end":{"line":12,"column":19,"offset":1072},"indent":[]}}],"position":{"start":{"line":12,"column":3,"offset":1056},"end":{"line":12,"column":21,"offset":1074},"indent":[]}},{"type":"text","value":" for any errors, including events that couldn't be submitted to the Events API: ","position":{"start":{"line":12,"column":21,"offset":1074},"end":{"line":12,"column":101,"offset":1154},"indent":[]}},{"type":"inlineCode","value":"/var/log/pdagent/pdagentd.log","position":{"start":{"line":12,"column":101,"offset":1154},"end":{"line":12,"column":132,"offset":1185},"indent":[]}}],"position":{"start":{"line":12,"column":3,"offset":1056},"end":{"line":12,"column":132,"offset":1185},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1054},"end":{"line":12,"column":132,"offset":1185},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":264},"end":{"line":12,"column":132,"offset":1185},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"block:api-header","label":"block:api-header","referenceType":"shortcut","children":[{"type":"text","value":"block:api-header","position":{"start":{"line":15,"column":2,"offset":1189},"end":{"line":15,"column":18,"offset":1205},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":1188},"end":{"line":15,"column":19,"offset":1206},"indent":[]}},{"type":"text","value":"\n{\n  \"title\": \"Outqueue Troubleshooting\"\n}\n","position":{"start":{"line":15,"column":19,"offset":1206},"end":{"line":19,"column":1,"offset":1249},"indent":[1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":19,"column":2,"offset":1250},"end":{"line":19,"column":8,"offset":1256},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":1249},"end":{"line":19,"column":9,"offset":1257},"indent":[]}},{"type":"text","value":"\nIn addition to ","position":{"start":{"line":19,"column":9,"offset":1257},"end":{"line":20,"column":16,"offset":1273},"indent":[1]}},{"type":"link","title":null,"url":"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-queue","children":[{"type":"text","value":"using ","position":{"start":{"line":20,"column":17,"offset":1274},"end":{"line":20,"column":23,"offset":1280},"indent":[]}},{"type":"inlineCode","value":"pd-queue","position":{"start":{"line":20,"column":23,"offset":1280},"end":{"line":20,"column":33,"offset":1290},"indent":[]}},{"type":"text","value":" to manage the queue","position":{"start":{"line":20,"column":33,"offset":1290},"end":{"line":20,"column":53,"offset":1310},"indent":[]}}],"position":{"start":{"line":20,"column":16,"offset":1273},"end":{"line":20,"column":122,"offset":1379},"indent":[]}},{"type":"text","value":", the agent's outqueue directories will often hold a wealth of information that is useful for troubleshooting. The queue may also be manually cleared or altered by working directly with the files.","position":{"start":{"line":20,"column":122,"offset":1379},"end":{"line":20,"column":318,"offset":1575},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":1188},"end":{"line":20,"column":318,"offset":1575},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Each file in these directories contains the body of a HTTP POST request that will be made to the PagerDuty Events API. You can thus see what your monitoring solutions are submitting to the agent by examining these files. They are given filenames that follow the naming convention:","position":{"start":{"line":22,"column":1,"offset":1577},"end":{"line":22,"column":281,"offset":1857},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1577},"end":{"line":22,"column":281,"offset":1857},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"{UNIX timestamp}_{integration key}.txt","position":{"start":{"line":24,"column":1,"offset":1859},"end":{"line":26,"column":4,"offset":1905},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"The Outqueue Directories","position":{"start":{"line":28,"column":4,"offset":1910},"end":{"line":28,"column":28,"offset":1934},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1907},"end":{"line":28,"column":28,"offset":1934},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The queue directories, located in ","position":{"start":{"line":30,"column":1,"offset":1936},"end":{"line":30,"column":35,"offset":1970},"indent":[]}},{"type":"inlineCode","value":"/var/lib/pdagent/outqueue","position":{"start":{"line":30,"column":35,"offset":1970},"end":{"line":30,"column":62,"offset":1997},"indent":[]}},{"type":"text","value":", include:\n","position":{"start":{"line":30,"column":62,"offset":1997},"end":{"line":31,"column":1,"offset":2008},"indent":[1]}},{"type":"linkReference","identifier":"block:parameters","label":"block:parameters","referenceType":"shortcut","children":[{"type":"text","value":"block:parameters","position":{"start":{"line":31,"column":2,"offset":2009},"end":{"line":31,"column":18,"offset":2025},"indent":[]}}],"position":{"start":{"line":31,"column":1,"offset":2008},"end":{"line":31,"column":19,"offset":2026},"indent":[]}},{"type":"text","value":"\n{\n  \"data\": {\n    \"h-0\": \"Directory\",\n    \"h-1\": \"Role\",\n    \"0-0\": \"","position":{"start":{"line":31,"column":19,"offset":2026},"end":{"line":36,"column":13,"offset":2096},"indent":[1,1,1,1,1]}},{"type":"inlineCode","value":"err","position":{"start":{"line":36,"column":13,"offset":2096},"end":{"line":36,"column":18,"offset":2101},"indent":[]}},{"type":"text","value":"\",\n    \"0-1\": \"Events for which delivery to the PagerDuty Events API was attempted, but was not successful due to a ","position":{"start":{"line":36,"column":18,"offset":2101},"end":{"line":37,"column":114,"offset":2217},"indent":[1]}},{"type":"inlineCode","value":"400 Invalid Request","position":{"start":{"line":37,"column":114,"offset":2217},"end":{"line":37,"column":135,"offset":2238},"indent":[]}},{"type":"text","value":" response from PagerDuty. Malformed events (i.e. having no integration key) that cannot be submitted will thus be kept here.\",\n    \"1-0\": \"","position":{"start":{"line":37,"column":135,"offset":2238},"end":{"line":38,"column":13,"offset":2377},"indent":[1]}},{"type":"inlineCode","value":"suc","position":{"start":{"line":38,"column":13,"offset":2377},"end":{"line":38,"column":18,"offset":2382},"indent":[]}},{"type":"text","value":"\",\n    \"1-1\": \"Successfully submitted events. If you see an event file cached here, it was sent to PagerDuty. If the event did not trigger an incident in PagerDuty, and you are having difficulty troubleshooting why it did not, contact ","position":{"start":{"line":38,"column":18,"offset":2382},"end":{"line":39,"column":233,"offset":2617},"indent":[1]}},{"type":"link","title":null,"url":"mailto:support@pagerduty.com","children":[{"type":"text","value":"PagerDuty Support","position":{"start":{"line":39,"column":234,"offset":2618},"end":{"line":39,"column":251,"offset":2635},"indent":[]}}],"position":{"start":{"line":39,"column":233,"offset":2617},"end":{"line":39,"column":282,"offset":2666},"indent":[]}},{"type":"text","value":".\",\n    \"2-0\": \"","position":{"start":{"line":39,"column":282,"offset":2666},"end":{"line":40,"column":13,"offset":2682},"indent":[1]}},{"type":"inlineCode","value":"tmp","position":{"start":{"line":40,"column":13,"offset":2682},"end":{"line":40,"column":18,"offset":2687},"indent":[]}},{"type":"text","value":"\",\n    \"2-1\": \"Event files submitted to the agent by external processes, i.e. integration scripts or ","position":{"start":{"line":40,"column":18,"offset":2687},"end":{"line":41,"column":99,"offset":2788},"indent":[1]}},{"type":"inlineCode","value":"pd-send","position":{"start":{"line":41,"column":99,"offset":2788},"end":{"line":41,"column":108,"offset":2797},"indent":[]}},{"type":"text","value":", will be stored in here.\",\n    \"3-0\": \"","position":{"start":{"line":41,"column":108,"offset":2797},"end":{"line":42,"column":13,"offset":2837},"indent":[1]}},{"type":"inlineCode","value":"pdq","position":{"start":{"line":42,"column":13,"offset":2837},"end":{"line":42,"column":18,"offset":2842},"indent":[]}},{"type":"text","value":"\",\n    \"3-1\": \"The queue of events to be sent; will contain symbolic links to the files in ","position":{"start":{"line":42,"column":18,"offset":2842},"end":{"line":43,"column":89,"offset":2933},"indent":[1]}},{"type":"inlineCode","value":"tmp","position":{"start":{"line":43,"column":89,"offset":2933},"end":{"line":43,"column":94,"offset":2938},"indent":[]}},{"type":"text","value":".\"\n  },\n  \"cols\": 2,\n  \"rows\": 4\n}\n","position":{"start":{"line":43,"column":94,"offset":2938},"end":{"line":48,"column":1,"offset":2973},"indent":[1,1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":48,"column":2,"offset":2974},"end":{"line":48,"column":8,"offset":2980},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":2973},"end":{"line":48,"column":9,"offset":2981},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":1936},"end":{"line":48,"column":9,"offset":2981},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"block:callout","label":"block:callout","referenceType":"shortcut","children":[{"type":"text","value":"block:callout","position":{"start":{"line":50,"column":2,"offset":2984},"end":{"line":50,"column":15,"offset":2997},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":2983},"end":{"line":50,"column":16,"offset":2998},"indent":[]}},{"type":"text","value":"\n{\n  \"type\": \"warning\",\n  \"title\": \"Event Expiration and Queue Cleaning\",\n  \"body\": \"Events are deleted from the outqueue directories at a regular interval, when their age exceeds a predefined length in seconds. The default age threshold is one week old, and the default cleaning interval is three hours. Both the interval and the age threshold are defined in the main ","position":{"start":{"line":50,"column":16,"offset":2998},"end":{"line":54,"column":296,"offset":3367},"indent":[1,1,1,1]}},{"type":"link","title":null,"url":"https://github.com/PagerDuty/pdagent/blob/master/conf/pdagent.conf","children":[{"type":"text","value":"PagerDuty Agent configuration file","position":{"start":{"line":54,"column":297,"offset":3368},"end":{"line":54,"column":331,"offset":3402},"indent":[]}}],"position":{"start":{"line":54,"column":296,"offset":3367},"end":{"line":54,"column":400,"offset":3471},"indent":[]}},{"type":"text","value":", which should be located at path  ","position":{"start":{"line":54,"column":400,"offset":3471},"end":{"line":54,"column":435,"offset":3506},"indent":[]}},{"type":"inlineCode","value":"/etc/pdagent.conf","position":{"start":{"line":54,"column":435,"offset":3506},"end":{"line":54,"column":454,"offset":3525},"indent":[]}},{"type":"text","value":":\\n\\n","position":{"start":{"line":54,"column":454,"offset":3525},"end":{"line":54,"column":459,"offset":3530},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":" ","position":{"start":{"line":54,"column":460,"offset":3531},"end":{"line":54,"column":461,"offset":3532},"indent":[]}},{"type":"inlineCode","value":"cleanup_interval_secs","position":{"start":{"line":54,"column":461,"offset":3532},"end":{"line":54,"column":484,"offset":3555},"indent":[]}},{"type":"text","value":": The interval between when the queue is cleaned.\\n","position":{"start":{"line":54,"column":484,"offset":3555},"end":{"line":54,"column":535,"offset":3606},"indent":[]}}],"position":{"start":{"line":54,"column":459,"offset":3530},"end":{"line":54,"column":536,"offset":3607},"indent":[]}},{"type":"text","value":" ","position":{"start":{"line":54,"column":536,"offset":3607},"end":{"line":54,"column":537,"offset":3608},"indent":[]}},{"type":"inlineCode","value":"cleanup_threshold_secs","position":{"start":{"line":54,"column":537,"offset":3608},"end":{"line":54,"column":561,"offset":3632},"indent":[]}},{"type":"text","value":": The age in seconds, beyond which events will be deleted.\"\n}\n","position":{"start":{"line":54,"column":561,"offset":3632},"end":{"line":56,"column":1,"offset":3694},"indent":[1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":56,"column":2,"offset":3695},"end":{"line":56,"column":8,"offset":3701},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":3694},"end":{"line":56,"column":9,"offset":3702},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":2983},"end":{"line":56,"column":9,"offset":3702},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Manually Purging the Queue","position":{"start":{"line":57,"column":4,"offset":3706},"end":{"line":57,"column":30,"offset":3732},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":3703},"end":{"line":57,"column":30,"offset":3732},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In the event of a long network outage wherein a huge pileup of pending events occurs in the agent, the queue can be cleared out in order to avoid a storm of incidents in PagerDuty when the network connection is restored.","position":{"start":{"line":59,"column":1,"offset":3734},"end":{"line":59,"column":221,"offset":3954},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":3734},"end":{"line":59,"column":221,"offset":3954},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To clear the queue, run the following commands:","position":{"start":{"line":61,"column":1,"offset":3956},"end":{"line":61,"column":48,"offset":4003},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":3956},"end":{"line":61,"column":48,"offset":4003},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"sudo rm -vf /var/lib/pdagent/outqueue/pdq/*\nsudo rm -vf /var/lib/pdagent/outqueue/tmp/*","position":{"start":{"line":63,"column":1,"offset":4005},"end":{"line":66,"column":4,"offset":4100},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"block:api-header","label":"block:api-header","referenceType":"shortcut","children":[{"type":"text","value":"block:api-header","position":{"start":{"line":67,"column":2,"offset":4102},"end":{"line":67,"column":18,"offset":4118},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":4101},"end":{"line":67,"column":19,"offset":4119},"indent":[]}},{"type":"text","value":"\n{\n  \"title\": \"Network Troubleshooting\"\n}\n","position":{"start":{"line":67,"column":19,"offset":4119},"end":{"line":71,"column":1,"offset":4161},"indent":[1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":71,"column":2,"offset":4162},"end":{"line":71,"column":8,"offset":4168},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":4161},"end":{"line":71,"column":9,"offset":4169},"indent":[]}},{"type":"text","value":"\nThe host that is running PagerDuty Agent should be able to make a HTTPS connection to ","position":{"start":{"line":71,"column":9,"offset":4169},"end":{"line":72,"column":87,"offset":4256},"indent":[1]}},{"type":"inlineCode","value":"events.pagerduty.com","position":{"start":{"line":72,"column":87,"offset":4256},"end":{"line":72,"column":109,"offset":4278},"indent":[]}},{"type":"text","value":". Thus, if the LAN has no DNS service, or there is no route to the internet, or the local ACL (if any) does not permit connecting to remote hosts across the internet, PagerDuty Agent will not be able to send data to PagerDuty.","position":{"start":{"line":72,"column":109,"offset":4278},"end":{"line":72,"column":335,"offset":4504},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":4101},"end":{"line":72,"column":335,"offset":4504},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"First, verify that you can resolve the Events API:","position":{"start":{"line":74,"column":1,"offset":4506},"end":{"line":74,"column":51,"offset":4556},"indent":[]}}],"position":{"start":{"line":74,"column":1,"offset":4506},"end":{"line":74,"column":51,"offset":4556},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"dig events.pagerduty.com","position":{"start":{"line":76,"column":1,"offset":4558},"end":{"line":78,"column":4,"offset":4590},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If you get a ","position":{"start":{"line":80,"column":1,"offset":4592},"end":{"line":80,"column":14,"offset":4605},"indent":[]}},{"type":"inlineCode","value":"SRVFAIL","position":{"start":{"line":80,"column":14,"offset":4605},"end":{"line":80,"column":23,"offset":4614},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":80,"column":23,"offset":4614},"end":{"line":80,"column":27,"offset":4618},"indent":[]}},{"type":"inlineCode","value":"NXDOMAIN","position":{"start":{"line":80,"column":27,"offset":4618},"end":{"line":80,"column":37,"offset":4628},"indent":[]}},{"type":"text","value":" status response, the issue is with DNS.","position":{"start":{"line":80,"column":37,"offset":4628},"end":{"line":80,"column":77,"offset":4668},"indent":[]}}],"position":{"start":{"line":80,"column":1,"offset":4592},"end":{"line":80,"column":77,"offset":4668},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Next, test reachability. Our events API hosts should respond to ICMP, so you can use the ","position":{"start":{"line":82,"column":1,"offset":4670},"end":{"line":82,"column":90,"offset":4759},"indent":[]}},{"type":"inlineCode","value":"ping","position":{"start":{"line":82,"column":90,"offset":4759},"end":{"line":82,"column":96,"offset":4765},"indent":[]}},{"type":"text","value":" program as follows:","position":{"start":{"line":82,"column":96,"offset":4765},"end":{"line":82,"column":116,"offset":4785},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":4670},"end":{"line":82,"column":116,"offset":4785},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"ping -q -c 3 events.pagerduty.com","position":{"start":{"line":84,"column":1,"offset":4787},"end":{"line":86,"column":4,"offset":4828},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If you see an indication of packet loss above 0%, or the program doesn't return after about five seconds, there is an issue with your network configuration, i.e. routing.","position":{"start":{"line":88,"column":1,"offset":4830},"end":{"line":88,"column":171,"offset":5000},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":4830},"end":{"line":88,"column":171,"offset":5000},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Next, check to see if you can make a TCP connection to the Events API with netcat:","position":{"start":{"line":90,"column":1,"offset":5002},"end":{"line":90,"column":83,"offset":5084},"indent":[]}}],"position":{"start":{"line":90,"column":1,"offset":5002},"end":{"line":90,"column":83,"offset":5084},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"nc -v events.pagerduty.com 443","position":{"start":{"line":92,"column":1,"offset":5086},"end":{"line":94,"column":4,"offset":5124},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You should see the following message:","position":{"start":{"line":96,"column":1,"offset":5126},"end":{"line":96,"column":38,"offset":5163},"indent":[]}}],"position":{"start":{"line":96,"column":1,"offset":5126},"end":{"line":96,"column":38,"offset":5163},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"Connection to events.pagerduty.com port 443 [tcp/https] succeeded!","position":{"start":{"line":98,"column":1,"offset":5165},"end":{"line":100,"column":4,"offset":5239},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Note, if using BSD Netcat, you can add flags ","position":{"start":{"line":102,"column":1,"offset":5241},"end":{"line":102,"column":46,"offset":5286},"indent":[]}},{"type":"inlineCode","value":"-G 5 -w 1","position":{"start":{"line":102,"column":46,"offset":5286},"end":{"line":102,"column":57,"offset":5297},"indent":[]}},{"type":"text","value":". That will make it exit one second after establishing a connection (","position":{"start":{"line":102,"column":57,"offset":5297},"end":{"line":102,"column":126,"offset":5366},"indent":[]}},{"type":"inlineCode","value":"-w 1","position":{"start":{"line":102,"column":126,"offset":5366},"end":{"line":102,"column":132,"offset":5372},"indent":[]}},{"type":"text","value":") and give up and report timeout after five seconds of waiting to establish one (","position":{"start":{"line":102,"column":132,"offset":5372},"end":{"line":102,"column":213,"offset":5453},"indent":[]}},{"type":"inlineCode","value":"-G 5","position":{"start":{"line":102,"column":213,"offset":5453},"end":{"line":102,"column":219,"offset":5459},"indent":[]}},{"type":"text","value":"). ","position":{"start":{"line":102,"column":219,"offset":5459},"end":{"line":102,"column":222,"offset":5462},"indent":[]}}],"position":{"start":{"line":102,"column":1,"offset":5241},"end":{"line":102,"column":222,"offset":5462},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In any case, if the netcat command takes too long to print out any messages, or produces an error message indicating a timeout, connection refusal (etc), check your network's firewall/ACL and refer to ","position":{"start":{"line":104,"column":1,"offset":5464},"end":{"line":104,"column":202,"offset":5665},"indent":[]}},{"type":"link","title":null,"url":"doc:whitelisting-ips","children":[{"type":"text","value":"Whitelisting IPs","position":{"start":{"line":104,"column":203,"offset":5666},"end":{"line":104,"column":219,"offset":5682},"indent":[]}}],"position":{"start":{"line":104,"column":202,"offset":5665},"end":{"line":104,"column":242,"offset":5705},"indent":[]}},{"type":"text","value":".\n","position":{"start":{"line":104,"column":242,"offset":5705},"end":{"line":105,"column":1,"offset":5707},"indent":[1]}},{"type":"linkReference","identifier":"block:api-header","label":"block:api-header","referenceType":"shortcut","children":[{"type":"text","value":"block:api-header","position":{"start":{"line":105,"column":2,"offset":5708},"end":{"line":105,"column":18,"offset":5724},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":5707},"end":{"line":105,"column":19,"offset":5725},"indent":[]}},{"type":"text","value":"\n{\n  \"title\": \"Testing TLS\"\n}\n","position":{"start":{"line":105,"column":19,"offset":5725},"end":{"line":109,"column":1,"offset":5755},"indent":[1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":109,"column":2,"offset":5756},"end":{"line":109,"column":8,"offset":5762},"indent":[]}}],"position":{"start":{"line":109,"column":1,"offset":5755},"end":{"line":109,"column":9,"offset":5763},"indent":[]}},{"type":"text","value":"\nOf note, PagerDuty Agent comes bundled with its own copy of the public server certificate, which it uses when it connects to validate the connection to the PagerDuty Events API.\n","position":{"start":{"line":109,"column":9,"offset":5763},"end":{"line":111,"column":1,"offset":5942},"indent":[1,1]}},{"type":"linkReference","identifier":"block:callout","label":"block:callout","referenceType":"shortcut","children":[{"type":"text","value":"block:callout","position":{"start":{"line":111,"column":2,"offset":5943},"end":{"line":111,"column":15,"offset":5956},"indent":[]}}],"position":{"start":{"line":111,"column":1,"offset":5942},"end":{"line":111,"column":16,"offset":5957},"indent":[]}},{"type":"text","value":"\n{\n  \"type\": \"warning\",\n  \"title\": \"Supported Protocols and the Server Certificate\",\n  \"body\": \"PagerDuty as of this writing only supports protocols ","position":{"start":{"line":111,"column":16,"offset":5957},"end":{"line":115,"column":65,"offset":6106},"indent":[1,1,1,1]}},{"type":"strong","children":[{"type":"text","value":"TLSv1.2","position":{"start":{"line":115,"column":67,"offset":6108},"end":{"line":115,"column":74,"offset":6115},"indent":[]}}],"position":{"start":{"line":115,"column":65,"offset":6106},"end":{"line":115,"column":76,"offset":6117},"indent":[]}},{"type":"text","value":". Older protocols (i.e. SSLv3) are widely considered to not be secure and thus are not supported. Traffic using older protocols and versions of TLS will be dropped.\"\n}\n","position":{"start":{"line":115,"column":76,"offset":6117},"end":{"line":117,"column":1,"offset":6285},"indent":[1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":117,"column":2,"offset":6286},"end":{"line":117,"column":8,"offset":6292},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":6285},"end":{"line":117,"column":9,"offset":6293},"indent":[]}},{"type":"text","value":"\n","position":{"start":{"line":117,"column":9,"offset":6293},"end":{"line":118,"column":1,"offset":6294},"indent":[1]}},{"type":"strong","children":[{"type":"text","value":"For the security-conscious:","position":{"start":{"line":118,"column":3,"offset":6296},"end":{"line":118,"column":30,"offset":6323},"indent":[]}}],"position":{"start":{"line":118,"column":1,"offset":6294},"end":{"line":118,"column":32,"offset":6325},"indent":[]}},{"type":"text","value":" to get extra certainty, one can check to see if a TLS connection can be established:","position":{"start":{"line":118,"column":32,"offset":6325},"end":{"line":118,"column":117,"offset":6410},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":5464},"end":{"line":118,"column":117,"offset":6410},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":null,"meta":null,"value":"openssl s_client -host events.pagerduty.com -port 443","position":{"start":{"line":120,"column":1,"offset":6412},"end":{"line":122,"column":4,"offset":6473},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You should see messages indicating a successful connection / TLS handshake, including the following certificate chain:","position":{"start":{"line":123,"column":1,"offset":6474},"end":{"line":123,"column":119,"offset":6592},"indent":[]}}],"position":{"start":{"line":123,"column":1,"offset":6474},"end":{"line":123,"column":119,"offset":6592},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"Certificate chain\n 0 s:/OU=GT12858685/OU=See www.rapidssl.com/resources/cps (c)14/OU=Domain Control Validated - RapidSSL(R)/CN=*.pagerduty.com\n   i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\n 1 s:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\n 2 s:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA","position":{"start":{"line":125,"column":1,"offset":6594},"end":{"line":133,"column":4,"offset":6999},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If you get a TLS handshake error, it may be the case that the GeoTrust root CA certificate isn't trusted on your system.","position":{"start":{"line":135,"column":1,"offset":7001},"end":{"line":135,"column":121,"offset":7121},"indent":[]}}],"position":{"start":{"line":135,"column":1,"offset":7001},"end":{"line":135,"column":121,"offset":7121},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.geotrust.com/resources/root-certificates/","children":[{"type":"text","value":"https://www.geotrust.com/resources/root-certificates/","position":{"start":{"line":137,"column":1,"offset":7123},"end":{"line":137,"column":54,"offset":7176},"indent":[]}}],"position":{"start":{"line":137,"column":1,"offset":7123},"end":{"line":137,"column":54,"offset":7176},"indent":[]}}],"position":{"start":{"line":137,"column":1,"offset":7123},"end":{"line":137,"column":54,"offset":7176},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In most distributions of Linux, the  ","position":{"start":{"line":139,"column":1,"offset":7178},"end":{"line":139,"column":38,"offset":7215},"indent":[]}},{"type":"inlineCode","value":"ca-certificates","position":{"start":{"line":139,"column":38,"offset":7215},"end":{"line":139,"column":55,"offset":7232},"indent":[]}},{"type":"text","value":" utility can be used for managing trusted certificates. \n","position":{"start":{"line":139,"column":55,"offset":7232},"end":{"line":140,"column":1,"offset":7289},"indent":[1]}},{"type":"linkReference","identifier":"block:api-header","label":"block:api-header","referenceType":"shortcut","children":[{"type":"text","value":"block:api-header","position":{"start":{"line":140,"column":2,"offset":7290},"end":{"line":140,"column":18,"offset":7306},"indent":[]}}],"position":{"start":{"line":140,"column":1,"offset":7289},"end":{"line":140,"column":19,"offset":7307},"indent":[]}},{"type":"text","value":"\n{\n  \"title\": \"Proxy Troubleshooting\"\n}\n","position":{"start":{"line":140,"column":19,"offset":7307},"end":{"line":144,"column":1,"offset":7347},"indent":[1,1,1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":144,"column":2,"offset":7348},"end":{"line":144,"column":8,"offset":7354},"indent":[]}}],"position":{"start":{"line":144,"column":1,"offset":7347},"end":{"line":144,"column":9,"offset":7355},"indent":[]}},{"type":"text","value":"\nOne issue that can be tricky to get past is proxy configuration. If web requests are not going through the proxy, or not going anywhere, do you know whether your system is running the daemon without the proper environment variables set, or if there's an issue with connecting to the proxy server (i.e. LAN restrictions)?","position":{"start":{"line":144,"column":9,"offset":7355},"end":{"line":145,"column":321,"offset":7676},"indent":[1]}}],"position":{"start":{"line":139,"column":1,"offset":7178},"end":{"line":145,"column":321,"offset":7676},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"block:callout","label":"block:callout","referenceType":"shortcut","children":[{"type":"text","value":"block:callout","position":{"start":{"line":147,"column":2,"offset":7679},"end":{"line":147,"column":15,"offset":7692},"indent":[]}}],"position":{"start":{"line":147,"column":1,"offset":7678},"end":{"line":147,"column":16,"offset":7693},"indent":[]}},{"type":"text","value":"\n{\n  \"type\": \"info\",\n  \"body\": \"For instructions on how to set up PagerDuty Agent to use a proxy server, refer to the ","position":{"start":{"line":147,"column":16,"offset":7693},"end":{"line":150,"column":98,"offset":7811},"indent":[1,1,1]}},{"type":"link","title":null,"url":"https://www.pagerduty.com/docs/guides/agent-install-guide#Proxy","children":[{"type":"text","value":"PagerDuty Agent installation guide","position":{"start":{"line":150,"column":99,"offset":7812},"end":{"line":150,"column":133,"offset":7846},"indent":[]}}],"position":{"start":{"line":150,"column":98,"offset":7811},"end":{"line":150,"column":199,"offset":7912},"indent":[]}},{"type":"text","value":".\"\n}\n","position":{"start":{"line":150,"column":199,"offset":7912},"end":{"line":152,"column":1,"offset":7917},"indent":[1,1]}},{"type":"linkReference","identifier":"/block","label":"/block","referenceType":"shortcut","children":[{"type":"text","value":"/block","position":{"start":{"line":152,"column":2,"offset":7918},"end":{"line":152,"column":8,"offset":7924},"indent":[]}}],"position":{"start":{"line":152,"column":1,"offset":7917},"end":{"line":152,"column":9,"offset":7925},"indent":[]}}],"position":{"start":{"line":147,"column":1,"offset":7678},"end":{"line":152,"column":9,"offset":7925},"indent":[1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Network Issues Maybe?","position":{"start":{"line":153,"column":4,"offset":7929},"end":{"line":153,"column":25,"offset":7950},"indent":[]}}],"position":{"start":{"line":153,"column":1,"offset":7926},"end":{"line":153,"column":25,"offset":7950},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before any of the following, it's a good idea to check that the proxy server can be reached using standard networking tools. If the hostname is ","position":{"start":{"line":155,"column":1,"offset":7952},"end":{"line":155,"column":145,"offset":8096},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"proxy.local","position":{"start":{"line":155,"column":147,"offset":8098},"end":{"line":155,"column":160,"offset":8111},"indent":[]}}],"position":{"start":{"line":155,"column":145,"offset":8096},"end":{"line":155,"column":162,"offset":8113},"indent":[]}},{"type":"text","value":" and the port is ","position":{"start":{"line":155,"column":162,"offset":8113},"end":{"line":155,"column":179,"offset":8130},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"8118","position":{"start":{"line":155,"column":181,"offset":8132},"end":{"line":155,"column":187,"offset":8138},"indent":[]}}],"position":{"start":{"line":155,"column":179,"offset":8130},"end":{"line":155,"column":189,"offset":8140},"indent":[]}},{"type":"text","value":", the commands to do this will be similar to the basic troubleshooting steps in the previous section:","position":{"start":{"line":155,"column":189,"offset":8140},"end":{"line":155,"column":290,"offset":8241},"indent":[]}}],"position":{"start":{"line":155,"column":1,"offset":7952},"end":{"line":155,"column":290,"offset":8241},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"ping proxy.local","position":{"start":{"line":157,"column":6,"offset":8248},"end":{"line":157,"column":24,"offset":8266},"indent":[]}}],"position":{"start":{"line":157,"column":4,"offset":8246},"end":{"line":157,"column":26,"offset":8268},"indent":[]}},{"type":"text","value":" to see if it can be reached","position":{"start":{"line":157,"column":26,"offset":8268},"end":{"line":157,"column":54,"offset":8296},"indent":[]}}],"position":{"start":{"line":157,"column":4,"offset":8246},"end":{"line":157,"column":54,"offset":8296},"indent":[]}}],"position":{"start":{"line":157,"column":1,"offset":8243},"end":{"line":157,"column":54,"offset":8296},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"dig proxy.local","position":{"start":{"line":158,"column":7,"offset":8303},"end":{"line":158,"column":24,"offset":8320},"indent":[]}}],"position":{"start":{"line":158,"column":5,"offset":8301},"end":{"line":158,"column":26,"offset":8322},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":158,"column":26,"offset":8322},"end":{"line":158,"column":30,"offset":8326},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"host proxy.local","position":{"start":{"line":158,"column":32,"offset":8328},"end":{"line":158,"column":50,"offset":8346},"indent":[]}}],"position":{"start":{"line":158,"column":30,"offset":8326},"end":{"line":158,"column":52,"offset":8348},"indent":[]}},{"type":"text","value":" to see if the hostname resolves","position":{"start":{"line":158,"column":52,"offset":8348},"end":{"line":158,"column":84,"offset":8380},"indent":[]}}],"position":{"start":{"line":158,"column":5,"offset":8301},"end":{"line":158,"column":84,"offset":8380},"indent":[]}}],"position":{"start":{"line":158,"column":1,"offset":8297},"end":{"line":158,"column":84,"offset":8380},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"inlineCode","value":"nc -v proxy.local 8118","position":{"start":{"line":159,"column":6,"offset":8386},"end":{"line":159,"column":30,"offset":8410},"indent":[]}}],"position":{"start":{"line":159,"column":4,"offset":8384},"end":{"line":159,"column":32,"offset":8412},"indent":[]}},{"type":"text","value":" to check that the port is open and can be connected to","position":{"start":{"line":159,"column":32,"offset":8412},"end":{"line":159,"column":87,"offset":8467},"indent":[]}}],"position":{"start":{"line":159,"column":4,"offset":8384},"end":{"line":159,"column":87,"offset":8467},"indent":[]}}],"position":{"start":{"line":159,"column":1,"offset":8381},"end":{"line":159,"column":87,"offset":8467},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Finally, try using ","position":{"start":{"line":160,"column":4,"offset":8471},"end":{"line":160,"column":23,"offset":8490},"indent":[]}},{"type":"inlineCode","value":"curl","position":{"start":{"line":160,"column":23,"offset":8490},"end":{"line":160,"column":29,"offset":8496},"indent":[]}},{"type":"text","value":" to connect through the proxy to the events API's agent heartbeat endpoint. How clients authenticate through the proxy may vary, and other settings may be needed, so you will need to specify extended proxy options; see the documentation for this under ","position":{"start":{"line":160,"column":29,"offset":8496},"end":{"line":160,"column":281,"offset":8748},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"man curl","position":{"start":{"line":160,"column":283,"offset":8750},"end":{"line":160,"column":293,"offset":8760},"indent":[]}}],"position":{"start":{"line":160,"column":281,"offset":8748},"end":{"line":160,"column":295,"offset":8762},"indent":[]}}],"position":{"start":{"line":160,"column":4,"offset":8471},"end":{"line":160,"column":295,"offset":8762},"indent":[]}}],"position":{"start":{"line":160,"column":1,"offset":8468},"end":{"line":160,"column":295,"offset":8762},"indent":[]}}],"position":{"start":{"line":157,"column":1,"offset":8243},"end":{"line":160,"column":295,"offset":8762},"indent":[1,1,1]}},{"type":"code","lang":null,"meta":null,"value":"curl -proxy proxy.local:8118 [additional proxy options] https://api.pagerduty.com/agent/2014-03-14/heartbeat","position":{"start":{"line":162,"column":1,"offset":8764},"end":{"line":164,"column":4,"offset":8880},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If all goes well, you should receive a response that looks like ","position":{"start":{"line":166,"column":1,"offset":8882},"end":{"line":166,"column":65,"offset":8946},"indent":[]}},{"type":"inlineCode","value":"{\"heartbeat_interval_secs\":86400}","position":{"start":{"line":166,"column":65,"offset":8946},"end":{"line":166,"column":100,"offset":8981},"indent":[]}}],"position":{"start":{"line":166,"column":1,"offset":8882},"end":{"line":166,"column":100,"offset":8981},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Environment Variables?","position":{"start":{"line":168,"column":4,"offset":8986},"end":{"line":168,"column":26,"offset":9008},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":8983},"end":{"line":168,"column":26,"offset":9008},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The thread that actually performs the sending of events to PagerDuty is the daemon, and for it to use the proxy requires environment variables. To elucidate, the underlying Python library used to make the HTTPS connection is ","position":{"start":{"line":170,"column":1,"offset":9010},"end":{"line":170,"column":226,"offset":9235},"indent":[]}},{"type":"inlineCode","value":"urllib2","position":{"start":{"line":170,"column":226,"offset":9235},"end":{"line":170,"column":235,"offset":9244},"indent":[]}},{"type":"text","value":". Per the ","position":{"start":{"line":170,"column":235,"offset":9244},"end":{"line":170,"column":245,"offset":9254},"indent":[]}},{"type":"link","title":null,"url":"https://docs.python.org/2/library/urllib2.html#urllib2.urlopen","children":[{"type":"text","value":"documentation on urllib2.urlopen","position":{"start":{"line":170,"column":246,"offset":9255},"end":{"line":170,"column":278,"offset":9287},"indent":[]}}],"position":{"start":{"line":170,"column":245,"offset":9254},"end":{"line":170,"column":343,"offset":9352},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":170,"column":343,"offset":9352},"end":{"line":170,"column":344,"offset":9353},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":9010},"end":{"line":170,"column":344,"offset":9353},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"In addition, if proxy settings are detected (for example, when a ","position":{"start":{"line":172,"column":3,"offset":9357},"end":{"line":172,"column":68,"offset":9422},"indent":[]}},{"type":"inlineCode","value":"*_proxy","position":{"start":{"line":172,"column":68,"offset":9422},"end":{"line":172,"column":77,"offset":9431},"indent":[]}},{"type":"text","value":" environment variable like ","position":{"start":{"line":172,"column":77,"offset":9431},"end":{"line":172,"column":104,"offset":9458},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"http_proxy","position":{"start":{"line":172,"column":106,"offset":9460},"end":{"line":172,"column":118,"offset":9472},"indent":[]}}],"position":{"start":{"line":172,"column":104,"offset":9458},"end":{"line":172,"column":120,"offset":9474},"indent":[]}},{"type":"text","value":" is set), ","position":{"start":{"line":172,"column":120,"offset":9474},"end":{"line":172,"column":130,"offset":9484},"indent":[]}},{"type":"link","title":null,"url":"https://docs.python.org/2/library/urllib2.html#urllib2.ProxyHandler","children":[{"type":"inlineCode","value":"ProxyHandler","position":{"start":{"line":172,"column":131,"offset":9485},"end":{"line":172,"column":145,"offset":9499},"indent":[]}}],"position":{"start":{"line":172,"column":130,"offset":9484},"end":{"line":172,"column":215,"offset":9569},"indent":[]}},{"type":"text","value":" is default installed and makes sure the requests are handled through the proxy.","position":{"start":{"line":172,"column":215,"offset":9569},"end":{"line":172,"column":295,"offset":9649},"indent":[]}}],"position":{"start":{"line":172,"column":3,"offset":9357},"end":{"line":172,"column":295,"offset":9649},"indent":[]}}],"position":{"start":{"line":172,"column":1,"offset":9355},"end":{"line":172,"column":295,"offset":9649},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Under \"Using a Proxy\" in the ","position":{"start":{"line":174,"column":1,"offset":9651},"end":{"line":174,"column":30,"offset":9680},"indent":[]}},{"type":"link","title":null,"url":"https://www.pagerduty.com/docs/guides/agent-install-guide/","children":[{"type":"text","value":"Agent Install Guide","position":{"start":{"line":174,"column":31,"offset":9681},"end":{"line":174,"column":50,"offset":9700},"indent":[]}}],"position":{"start":{"line":174,"column":30,"offset":9680},"end":{"line":174,"column":111,"offset":9761},"indent":[]}},{"type":"text","value":", two ways of configuring the environment variables for the daemon are described: systemd-based versus SysV init-based Linux systems. You can find out which of these your system uses by running ","position":{"start":{"line":174,"column":111,"offset":9761},"end":{"line":174,"column":305,"offset":9955},"indent":[]}},{"type":"inlineCode","value":"sudo stat /proc/1/exe","position":{"start":{"line":174,"column":305,"offset":9955},"end":{"line":174,"column":328,"offset":9978},"indent":[]}},{"type":"text","value":", which will show you the executable associated with the PID=1 process.","position":{"start":{"line":174,"column":328,"offset":9978},"end":{"line":174,"column":399,"offset":10049},"indent":[]}}],"position":{"start":{"line":174,"column":1,"offset":9651},"end":{"line":174,"column":399,"offset":10049},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Once you've made sure that the daemon is configured with the environment variables using the correct method, you will need to make sure the changes are applied, which may vary based on your system. In ","position":{"start":{"line":176,"column":1,"offset":10051},"end":{"line":176,"column":202,"offset":10252},"indent":[]}},{"type":"inlineCode","value":"systemd","position":{"start":{"line":176,"column":202,"offset":10252},"end":{"line":176,"column":211,"offset":10261},"indent":[]}},{"type":"text","value":" based systems, you will be prompted to run ","position":{"start":{"line":176,"column":211,"offset":10261},"end":{"line":176,"column":255,"offset":10305},"indent":[]}},{"type":"inlineCode","value":"systemctl daemon-reload","position":{"start":{"line":176,"column":255,"offset":10305},"end":{"line":176,"column":280,"offset":10330},"indent":[]}},{"type":"text","value":" when you restart service ","position":{"start":{"line":176,"column":280,"offset":10330},"end":{"line":176,"column":306,"offset":10356},"indent":[]}},{"type":"inlineCode","value":"pdagent","position":{"start":{"line":176,"column":306,"offset":10356},"end":{"line":176,"column":315,"offset":10365},"indent":[]}},{"type":"text","value":" after modifying the service configuration, after which the service should be restarted once more for the changes to finally take effect.","position":{"start":{"line":176,"column":315,"offset":10365},"end":{"line":176,"column":452,"offset":10502},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":10051},"end":{"line":176,"column":452,"offset":10502},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Still Stuck?","position":{"start":{"line":178,"column":4,"offset":10507},"end":{"line":178,"column":16,"offset":10519},"indent":[]}}],"position":{"start":{"line":178,"column":1,"offset":10504},"end":{"line":178,"column":16,"offset":10519},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"As a last resort, failing all other troubleshooting, you can see the actual environment variables that the daemon is running with by adding a logging statement to the agent's component module ","position":{"start":{"line":180,"column":1,"offset":10521},"end":{"line":180,"column":193,"offset":10713},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/PagerDuty/pdagent/blob/master/pdagent/sendevent.py","children":[{"type":"inlineCode","value":"sendevent","position":{"start":{"line":180,"column":194,"offset":10714},"end":{"line":180,"column":205,"offset":10725},"indent":[]}}],"position":{"start":{"line":180,"column":193,"offset":10713},"end":{"line":180,"column":277,"offset":10797},"indent":[]}},{"type":"text","value":". On most Linux systems this will be in ","position":{"start":{"line":180,"column":277,"offset":10797},"end":{"line":180,"column":317,"offset":10837},"indent":[]}},{"type":"inlineCode","value":"/lib/python2.7/site-packages/pdagent/","position":{"start":{"line":180,"column":317,"offset":10837},"end":{"line":180,"column":356,"offset":10876},"indent":[]}},{"type":"text","value":", and the method to alter is the method ","position":{"start":{"line":180,"column":356,"offset":10876},"end":{"line":180,"column":396,"offset":10916},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"SendEventTask.send_event","position":{"start":{"line":180,"column":398,"offset":10918},"end":{"line":180,"column":424,"offset":10944},"indent":[]}}],"position":{"start":{"line":180,"column":396,"offset":10916},"end":{"line":180,"column":426,"offset":10946},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":180,"column":426,"offset":10946},"end":{"line":180,"column":427,"offset":10947},"indent":[]}}],"position":{"start":{"line":180,"column":1,"offset":10521},"end":{"line":180,"column":427,"offset":10947},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"def send_event(self, json_event_str, event_id):\n    import os; logger.info(str(os.environ)) # add this line","position":{"start":{"line":182,"column":1,"offset":10949},"end":{"line":185,"column":4,"offset":11064},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"After making the change, restart pdagent and try sending a test event using ","position":{"start":{"line":187,"column":1,"offset":11066},"end":{"line":187,"column":77,"offset":11142},"indent":[]}},{"type":"inlineCode","value":"pd-send","position":{"start":{"line":187,"column":77,"offset":11142},"end":{"line":187,"column":86,"offset":11151},"indent":[]}},{"type":"text","value":". After that, you'll find a message in the log that that looks like this:","position":{"start":{"line":187,"column":86,"offset":11151},"end":{"line":187,"column":159,"offset":11224},"indent":[]}}],"position":{"start":{"line":187,"column":1,"offset":11066},"end":{"line":187,"column":159,"offset":11224},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"2017-05-08 18:29:31,556 INFO    SendEventTask        pdagent.sendevent    {'TERM': 'xterm-256color', 'SHELL': '/bin/bash', 'SHLVL': '2', 'SYSTEMCTL_SKIP_REDIRECT': '', 'PWD': '/', 'LOGNAME': 'pdagent', 'USER': 'pdagent', 'HOME': '/home/pdagent', 'SYSTEMCTL_IGNORE_DEPENDENCIES': '', 'PATH': '/sbin:/usr/sbin:/bin:/usr/bin', 'XDG_SESSION_ID': '1', '_': '/usr/share/pdagent/bin/pdagentd.py'}","position":{"start":{"line":189,"column":1,"offset":11226},"end":{"line":191,"column":4,"offset":11623},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If the environment variables were set, they would have shown up in the print-out of the ","position":{"start":{"line":193,"column":1,"offset":11625},"end":{"line":193,"column":89,"offset":11713},"indent":[]}},{"type":"inlineCode","value":"os.environ","position":{"start":{"line":193,"column":89,"offset":11713},"end":{"line":193,"column":101,"offset":11725},"indent":[]}},{"type":"text","value":" dictionary, i.e. ","position":{"start":{"line":193,"column":101,"offset":11725},"end":{"line":193,"column":119,"offset":11743},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"'http_proxy': 'http://proxy.local:8118'","position":{"start":{"line":193,"column":121,"offset":11745},"end":{"line":193,"column":162,"offset":11786},"indent":[]}}],"position":{"start":{"line":193,"column":119,"offset":11743},"end":{"line":193,"column":164,"offset":11788},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":193,"column":164,"offset":11788},"end":{"line":193,"column":169,"offset":11793},"indent":[]}},{"type":"strong","children":[{"type":"inlineCode","value":"'https_proxy': 'https://proxy.local:8118'","position":{"start":{"line":193,"column":171,"offset":11795},"end":{"line":193,"column":214,"offset":11838},"indent":[]}}],"position":{"start":{"line":193,"column":169,"offset":11793},"end":{"line":193,"column":216,"offset":11840},"indent":[]}},{"type":"text","value":", which (note) are missing in the above line.","position":{"start":{"line":193,"column":216,"offset":11840},"end":{"line":193,"column":261,"offset":11885},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":11625},"end":{"line":193,"column":261,"offset":11885},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"PagerDuty Agent Troubleshooting Guide\",\"slug\":\"pagerduty-agent-troubleshooting-guide\",\"excerpt\":\"\"}","position":{"start":{"line":196,"column":1,"offset":11888},"end":{"line":196,"column":138,"offset":12025},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":196,"column":138,"offset":12025}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"PagerDuty Agent Troubleshooting Guide\",\n  \"slug\": \"pagerduty-agent-troubleshooting-guide\",\n  \"excerpt\": \"\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"PagerDuty Agent is an open-source utility for integrating standalone / on-premise monitoring tools with PagerDuty.\\n\", \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"First Steps\\\"\\n}\\n\", \"[/block]\", \"\\nIf you have trouble sending events to PagerDuty using the agent, run the following checks:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"a\", _extends({\n    parentName: \"strong\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#VerifyAgentRunning\"\n  }), \"Verify that the \", mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"pdagent\"), \" service is running.\")), \" If the service is not running, you can start it with the command \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"systemctl start pdagent\"), \" (on systemd-based systems) or \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"sudo service pdagent start\"), \" (on SysV init-based systems). Any events that were enqueued while the service was stopped will be sent when the service starts.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Check the service integration key:\"), \" make sure that the key is for the correct service and that it has been entered correctly.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Send a test event\"), \" using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"pd-send\"), \" as shown in \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-send\"\n  }), \"Sending an Event to PagerDuty\"), \". Remember to replace the key used in the example with your own PagerDuty Service Integration Key.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Check the logs\"), \" for any errors, including events that couldn't be submitted to the Events API: \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"/var/log/pdagent/pdagentd.log\"))), mdx(\"p\", null, \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Outqueue Troubleshooting\\\"\\n}\\n\", \"[/block]\", \"\\nIn addition to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-queue\"\n  }), \"using \", mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"pd-queue\"), \" to manage the queue\"), \", the agent's outqueue directories will often hold a wealth of information that is useful for troubleshooting. The queue may also be manually cleared or altered by working directly with the files.\"), mdx(\"p\", null, \"Each file in these directories contains the body of a HTTP POST request that will be made to the PagerDuty Events API. You can thus see what your monitoring solutions are submitting to the agent by examining these files. They are given filenames that follow the naming convention:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"{UNIX timestamp}_{integration key}.txt\\n\")), mdx(\"h2\", {\n    \"id\": \"the-outqueue-directories\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#the-outqueue-directories\",\n    \"aria-label\": \"the outqueue directories permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"The Outqueue Directories\"), mdx(\"p\", null, \"The queue directories, located in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/var/lib/pdagent/outqueue\"), \", include:\\n\", \"[block:parameters]\", \"\\n{\\n\\\"data\\\": {\\n\\\"h-0\\\": \\\"Directory\\\",\\n\\\"h-1\\\": \\\"Role\\\",\\n\\\"0-0\\\": \\\"\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"err\"), \"\\\",\\n\\\"0-1\\\": \\\"Events for which delivery to the PagerDuty Events API was attempted, but was not successful due to a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"400 Invalid Request\"), \" response from PagerDuty. Malformed events (i.e. having no integration key) that cannot be submitted will thus be kept here.\\\",\\n\\\"1-0\\\": \\\"\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"suc\"), \"\\\",\\n\\\"1-1\\\": \\\"Successfully submitted events. If you see an event file cached here, it was sent to PagerDuty. If the event did not trigger an incident in PagerDuty, and you are having difficulty troubleshooting why it did not, contact \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"mailto:support@pagerduty.com\"\n  }), \"PagerDuty Support\"), \".\\\",\\n\\\"2-0\\\": \\\"\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tmp\"), \"\\\",\\n\\\"2-1\\\": \\\"Event files submitted to the agent by external processes, i.e. integration scripts or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pd-send\"), \", will be stored in here.\\\",\\n\\\"3-0\\\": \\\"\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pdq\"), \"\\\",\\n\\\"3-1\\\": \\\"The queue of events to be sent; will contain symbolic links to the files in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tmp\"), \".\\\"\\n},\\n\\\"cols\\\": 2,\\n\\\"rows\\\": 4\\n}\\n\", \"[/block]\"), mdx(\"p\", null, \"[block:callout]\", \"\\n{\\n\\\"type\\\": \\\"warning\\\",\\n\\\"title\\\": \\\"Event Expiration and Queue Cleaning\\\",\\n\\\"body\\\": \\\"Events are deleted from the outqueue directories at a regular interval, when their age exceeds a predefined length in seconds. The default age threshold is one week old, and the default cleaning interval is three hours. Both the interval and the age threshold are defined in the main \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/PagerDuty/pdagent/blob/master/conf/pdagent.conf\"\n  }), \"PagerDuty Agent configuration file\"), \", which should be located at path  \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/etc/pdagent.conf\"), \":\\\\n\\\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \" \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"cleanup_interval_secs\"), \": The interval between when the queue is cleaned.\\\\n\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cleanup_threshold_secs\"), \": The age in seconds, beyond which events will be deleted.\\\"\\n}\\n\", \"[/block]\"), mdx(\"h2\", {\n    \"id\": \"manually-purging-the-queue\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#manually-purging-the-queue\",\n    \"aria-label\": \"manually purging the queue permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Manually Purging the Queue\"), mdx(\"p\", null, \"In the event of a long network outage wherein a huge pileup of pending events occurs in the agent, the queue can be cleared out in order to avoid a storm of incidents in PagerDuty when the network connection is restored.\"), mdx(\"p\", null, \"To clear the queue, run the following commands:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo rm -vf /var/lib/pdagent/outqueue/pdq/*\\nsudo rm -vf /var/lib/pdagent/outqueue/tmp/*\\n\")), mdx(\"p\", null, \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Network Troubleshooting\\\"\\n}\\n\", \"[/block]\", \"\\nThe host that is running PagerDuty Agent should be able to make a HTTPS connection to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"events.pagerduty.com\"), \". Thus, if the LAN has no DNS service, or there is no route to the internet, or the local ACL (if any) does not permit connecting to remote hosts across the internet, PagerDuty Agent will not be able to send data to PagerDuty.\"), mdx(\"p\", null, \"First, verify that you can resolve the Events API:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"dig events.pagerduty.com\\n\")), mdx(\"p\", null, \"If you get a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SRVFAIL\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NXDOMAIN\"), \" status response, the issue is with DNS.\"), mdx(\"p\", null, \"Next, test reachability. Our events API hosts should respond to ICMP, so you can use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ping\"), \" program as follows:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"ping -q -c 3 events.pagerduty.com\\n\")), mdx(\"p\", null, \"If you see an indication of packet loss above 0%, or the program doesn't return after about five seconds, there is an issue with your network configuration, i.e. routing.\"), mdx(\"p\", null, \"Next, check to see if you can make a TCP connection to the Events API with netcat:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"nc -v events.pagerduty.com 443\\n\")), mdx(\"p\", null, \"You should see the following message:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Connection to events.pagerduty.com port 443 [tcp/https] succeeded!\\n\")), mdx(\"p\", null, \"Note, if using BSD Netcat, you can add flags \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-G 5 -w 1\"), \". That will make it exit one second after establishing a connection (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-w 1\"), \") and give up and report timeout after five seconds of waiting to establish one (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"-G 5\"), \"). \"), mdx(\"p\", null, \"In any case, if the netcat command takes too long to print out any messages, or produces an error message indicating a timeout, connection refusal (etc), check your network's firewall/ACL and refer to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"doc:whitelisting-ips\"\n  }), \"Whitelisting IPs\"), \".\\n\", \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Testing TLS\\\"\\n}\\n\", \"[/block]\", \"\\nOf note, PagerDuty Agent comes bundled with its own copy of the public server certificate, which it uses when it connects to validate the connection to the PagerDuty Events API.\\n\", \"[block:callout]\", \"\\n{\\n\\\"type\\\": \\\"warning\\\",\\n\\\"title\\\": \\\"Supported Protocols and the Server Certificate\\\",\\n\\\"body\\\": \\\"PagerDuty as of this writing only supports protocols \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TLSv1.2\"), \". Older protocols (i.e. SSLv3) are widely considered to not be secure and thus are not supported. Traffic using older protocols and versions of TLS will be dropped.\\\"\\n}\\n\", \"[/block]\", \"\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"For the security-conscious:\"), \" to get extra certainty, one can check to see if a TLS connection can be established:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"openssl s_client -host events.pagerduty.com -port 443\\n\")), mdx(\"p\", null, \"You should see messages indicating a successful connection / TLS handshake, including the following certificate chain:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Certificate chain\\n 0 s:/OU=GT12858685/OU=See www.rapidssl.com/resources/cps (c)14/OU=Domain Control Validated - RapidSSL(R)/CN=*.pagerduty.com\\n   i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\\n 1 s:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\\n 2 s:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\\n\")), mdx(\"p\", null, \"If you get a TLS handshake error, it may be the case that the GeoTrust root CA certificate isn't trusted on your system.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.geotrust.com/resources/root-certificates/\"\n  }), \"https://www.geotrust.com/resources/root-certificates/\")), mdx(\"p\", null, \"In most distributions of Linux, the  \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ca-certificates\"), \" utility can be used for managing trusted certificates.\\n\", \"[block:api-header]\", \"\\n{\\n\\\"title\\\": \\\"Proxy Troubleshooting\\\"\\n}\\n\", \"[/block]\", \"\\nOne issue that can be tricky to get past is proxy configuration. If web requests are not going through the proxy, or not going anywhere, do you know whether your system is running the daemon without the proper environment variables set, or if there's an issue with connecting to the proxy server (i.e. LAN restrictions)?\"), mdx(\"p\", null, \"[block:callout]\", \"\\n{\\n\\\"type\\\": \\\"info\\\",\\n\\\"body\\\": \\\"For instructions on how to set up PagerDuty Agent to use a proxy server, refer to the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#Proxy\"\n  }), \"PagerDuty Agent installation guide\"), \".\\\"\\n}\\n\", \"[/block]\"), mdx(\"h2\", {\n    \"id\": \"network-issues-maybe\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#network-issues-maybe\",\n    \"aria-label\": \"network issues maybe permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Network Issues Maybe?\"), mdx(\"p\", null, \"Before any of the following, it's a good idea to check that the proxy server can be reached using standard networking tools. If the hostname is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"proxy.local\")), \" and the port is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"8118\")), \", the commands to do this will be similar to the basic troubleshooting steps in the previous section:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"ping proxy.local\")), \" to see if it can be reached\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"dig proxy.local\")), \" or \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"host proxy.local\")), \" to see if the hostname resolves\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"nc -v proxy.local 8118\")), \" to check that the port is open and can be connected to\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Finally, try using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"curl\"), \" to connect through the proxy to the events API's agent heartbeat endpoint. How clients authenticate through the proxy may vary, and other settings may be needed, so you will need to specify extended proxy options; see the documentation for this under \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"man curl\")))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"curl -proxy proxy.local:8118 [additional proxy options] https://api.pagerduty.com/agent/2014-03-14/heartbeat\\n\")), mdx(\"p\", null, \"If all goes well, you should receive a response that looks like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"{\\\"heartbeat_interval_secs\\\":86400}\")), mdx(\"h2\", {\n    \"id\": \"environment-variables\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#environment-variables\",\n    \"aria-label\": \"environment variables permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Environment Variables?\"), mdx(\"p\", null, \"The thread that actually performs the sending of events to PagerDuty is the daemon, and for it to use the proxy requires environment variables. To elucidate, the underlying Python library used to make the HTTPS connection is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"urllib2\"), \". Per the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.python.org/2/library/urllib2.html#urllib2.urlopen\"\n  }), \"documentation on urllib2.urlopen\"), \":\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"In addition, if proxy settings are detected (for example, when a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"*_proxy\"), \" environment variable like \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"http_proxy\")), \" is set), \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.python.org/2/library/urllib2.html#urllib2.ProxyHandler\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"ProxyHandler\")), \" is default installed and makes sure the requests are handled through the proxy.\")), mdx(\"p\", null, \"Under \\\"Using a Proxy\\\" in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide/\"\n  }), \"Agent Install Guide\"), \", two ways of configuring the environment variables for the daemon are described: systemd-based versus SysV init-based Linux systems. You can find out which of these your system uses by running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sudo stat /proc/1/exe\"), \", which will show you the executable associated with the PID=1 process.\"), mdx(\"p\", null, \"Once you've made sure that the daemon is configured with the environment variables using the correct method, you will need to make sure the changes are applied, which may vary based on your system. In \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"systemd\"), \" based systems, you will be prompted to run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"systemctl daemon-reload\"), \" when you restart service \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pdagent\"), \" after modifying the service configuration, after which the service should be restarted once more for the changes to finally take effect.\"), mdx(\"h2\", {\n    \"id\": \"still-stuck\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#still-stuck\",\n    \"aria-label\": \"still stuck permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Still Stuck?\"), mdx(\"p\", null, \"As a last resort, failing all other troubleshooting, you can see the actual environment variables that the daemon is running with by adding a logging statement to the agent's component module \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/PagerDuty/pdagent/blob/master/pdagent/sendevent.py\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"sendevent\")), \". On most Linux systems this will be in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/lib/python2.7/site-packages/pdagent/\"), \", and the method to alter is the method \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"SendEventTask.send_event\")), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"def send_event(self, json_event_str, event_id):\\n    import os; logger.info(str(os.environ)) # add this line\\n\")), mdx(\"p\", null, \"After making the change, restart pdagent and try sending a test event using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pd-send\"), \". After that, you'll find a message in the log that that looks like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"2017-05-08 18:29:31,556 INFO    SendEventTask        pdagent.sendevent    {'TERM': 'xterm-256color', 'SHELL': '/bin/bash', 'SHLVL': '2', 'SYSTEMCTL_SKIP_REDIRECT': '', 'PWD': '/', 'LOGNAME': 'pdagent', 'USER': 'pdagent', 'HOME': '/home/pdagent', 'SYSTEMCTL_IGNORE_DEPENDENCIES': '', 'PATH': '/sbin:/usr/sbin:/bin:/usr/bin', 'XDG_SESSION_ID': '1', '_': '/usr/share/pdagent/bin/pdagentd.py'}\\n\")), mdx(\"p\", null, \"If the environment variables were set, they would have shown up in the print-out of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"os.environ\"), \" dictionary, i.e. \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"'http_proxy': 'http://proxy.local:8118'\")), \" and \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"'https_proxy': 'https://proxy.local:8118'\")), \", which (note) are missing in the above line.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"PagerDuty Agent Troubleshooting Guide\",\n  \"slug\": \"pagerduty-agent-troubleshooting-guide\",\n  \"excerpt\": \"\"\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`PagerDuty Agent is an open-source utility for integrating standalone / on-premise monitoring tools with PagerDuty.\n`}{`[block:api-header]`}{`\n{\n\"title\": \"First Steps\"\n}\n`}{`[/block]`}{`\nIf you have trouble sending events to PagerDuty using the agent, run the following checks:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\"><a parentName=\"strong\" {...{\n            \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#VerifyAgentRunning\"\n          }}>{`Verify that the `}<inlineCode parentName=\"a\">{`pdagent`}</inlineCode>{` service is running.`}</a></strong>{` If the service is not running, you can start it with the command `}<inlineCode parentName=\"li\">{`systemctl start pdagent`}</inlineCode>{` (on systemd-based systems) or `}<inlineCode parentName=\"li\">{`sudo service pdagent start`}</inlineCode>{` (on SysV init-based systems). Any events that were enqueued while the service was stopped will be sent when the service starts.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Check the service integration key:`}</strong>{` make sure that the key is for the correct service and that it has been entered correctly.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Send a test event`}</strong>{` using `}<inlineCode parentName=\"li\">{`pd-send`}</inlineCode>{` as shown in `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-send\"\n        }}>{`Sending an Event to PagerDuty`}</a>{`. Remember to replace the key used in the example with your own PagerDuty Service Integration Key.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Check the logs`}</strong>{` for any errors, including events that couldn't be submitted to the Events API: `}<inlineCode parentName=\"li\">{`/var/log/pdagent/pdagentd.log`}</inlineCode></li>\n    </ul>\n    <p>{`[block:api-header]`}{`\n{\n\"title\": \"Outqueue Troubleshooting\"\n}\n`}{`[/block]`}{`\nIn addition to `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#pd-queue\"\n      }}>{`using `}<inlineCode parentName=\"a\">{`pd-queue`}</inlineCode>{` to manage the queue`}</a>{`, the agent's outqueue directories will often hold a wealth of information that is useful for troubleshooting. The queue may also be manually cleared or altered by working directly with the files.`}</p>\n    <p>{`Each file in these directories contains the body of a HTTP POST request that will be made to the PagerDuty Events API. You can thus see what your monitoring solutions are submitting to the agent by examining these files. They are given filenames that follow the naming convention:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`{UNIX timestamp}_{integration key}.txt\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"the-outqueue-directories\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#the-outqueue-directories\",\n        \"aria-label\": \"the outqueue directories permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`The Outqueue Directories`}</h2>\n    <p>{`The queue directories, located in `}<inlineCode parentName=\"p\">{`/var/lib/pdagent/outqueue`}</inlineCode>{`, include:\n`}{`[block:parameters]`}{`\n{\n\"data\": {\n\"h-0\": \"Directory\",\n\"h-1\": \"Role\",\n\"0-0\": \"`}<inlineCode parentName=\"p\">{`err`}</inlineCode>{`\",\n\"0-1\": \"Events for which delivery to the PagerDuty Events API was attempted, but was not successful due to a `}<inlineCode parentName=\"p\">{`400 Invalid Request`}</inlineCode>{` response from PagerDuty. Malformed events (i.e. having no integration key) that cannot be submitted will thus be kept here.\",\n\"1-0\": \"`}<inlineCode parentName=\"p\">{`suc`}</inlineCode>{`\",\n\"1-1\": \"Successfully submitted events. If you see an event file cached here, it was sent to PagerDuty. If the event did not trigger an incident in PagerDuty, and you are having difficulty troubleshooting why it did not, contact `}<a parentName=\"p\" {...{\n        \"href\": \"mailto:support@pagerduty.com\"\n      }}>{`PagerDuty Support`}</a>{`.\",\n\"2-0\": \"`}<inlineCode parentName=\"p\">{`tmp`}</inlineCode>{`\",\n\"2-1\": \"Event files submitted to the agent by external processes, i.e. integration scripts or `}<inlineCode parentName=\"p\">{`pd-send`}</inlineCode>{`, will be stored in here.\",\n\"3-0\": \"`}<inlineCode parentName=\"p\">{`pdq`}</inlineCode>{`\",\n\"3-1\": \"The queue of events to be sent; will contain symbolic links to the files in `}<inlineCode parentName=\"p\">{`tmp`}</inlineCode>{`.\"\n},\n\"cols\": 2,\n\"rows\": 4\n}\n`}{`[/block]`}</p>\n    <p>{`[block:callout]`}{`\n{\n\"type\": \"warning\",\n\"title\": \"Event Expiration and Queue Cleaning\",\n\"body\": \"Events are deleted from the outqueue directories at a regular interval, when their age exceeds a predefined length in seconds. The default age threshold is one week old, and the default cleaning interval is three hours. Both the interval and the age threshold are defined in the main `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/PagerDuty/pdagent/blob/master/conf/pdagent.conf\"\n      }}>{`PagerDuty Agent configuration file`}</a>{`, which should be located at path  `}<inlineCode parentName=\"p\">{`/etc/pdagent.conf`}</inlineCode>{`:\\\\n\\\\n`}<em parentName=\"p\">{` `}<inlineCode parentName=\"em\">{`cleanup_interval_secs`}</inlineCode>{`: The interval between when the queue is cleaned.\\\\n`}</em>{` `}<inlineCode parentName=\"p\">{`cleanup_threshold_secs`}</inlineCode>{`: The age in seconds, beyond which events will be deleted.\"\n}\n`}{`[/block]`}</p>\n    <h2 {...{\n      \"id\": \"manually-purging-the-queue\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#manually-purging-the-queue\",\n        \"aria-label\": \"manually purging the queue permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Manually Purging the Queue`}</h2>\n    <p>{`In the event of a long network outage wherein a huge pileup of pending events occurs in the agent, the queue can be cleared out in order to avoid a storm of incidents in PagerDuty when the network connection is restored.`}</p>\n    <p>{`To clear the queue, run the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`sudo rm -vf /var/lib/pdagent/outqueue/pdq/*\nsudo rm -vf /var/lib/pdagent/outqueue/tmp/*\n`}</code></pre>\n    <p>{`[block:api-header]`}{`\n{\n\"title\": \"Network Troubleshooting\"\n}\n`}{`[/block]`}{`\nThe host that is running PagerDuty Agent should be able to make a HTTPS connection to `}<inlineCode parentName=\"p\">{`events.pagerduty.com`}</inlineCode>{`. Thus, if the LAN has no DNS service, or there is no route to the internet, or the local ACL (if any) does not permit connecting to remote hosts across the internet, PagerDuty Agent will not be able to send data to PagerDuty.`}</p>\n    <p>{`First, verify that you can resolve the Events API:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`dig events.pagerduty.com\n`}</code></pre>\n    <p>{`If you get a `}<inlineCode parentName=\"p\">{`SRVFAIL`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`NXDOMAIN`}</inlineCode>{` status response, the issue is with DNS.`}</p>\n    <p>{`Next, test reachability. Our events API hosts should respond to ICMP, so you can use the `}<inlineCode parentName=\"p\">{`ping`}</inlineCode>{` program as follows:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ping -q -c 3 events.pagerduty.com\n`}</code></pre>\n    <p>{`If you see an indication of packet loss above 0%, or the program doesn't return after about five seconds, there is an issue with your network configuration, i.e. routing.`}</p>\n    <p>{`Next, check to see if you can make a TCP connection to the Events API with netcat:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`nc -v events.pagerduty.com 443\n`}</code></pre>\n    <p>{`You should see the following message:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`Connection to events.pagerduty.com port 443 [tcp/https] succeeded!\n`}</code></pre>\n    <p>{`Note, if using BSD Netcat, you can add flags `}<inlineCode parentName=\"p\">{`-G 5 -w 1`}</inlineCode>{`. That will make it exit one second after establishing a connection (`}<inlineCode parentName=\"p\">{`-w 1`}</inlineCode>{`) and give up and report timeout after five seconds of waiting to establish one (`}<inlineCode parentName=\"p\">{`-G 5`}</inlineCode>{`). `}</p>\n    <p>{`In any case, if the netcat command takes too long to print out any messages, or produces an error message indicating a timeout, connection refusal (etc), check your network's firewall/ACL and refer to `}<a parentName=\"p\" {...{\n        \"href\": \"doc:whitelisting-ips\"\n      }}>{`Whitelisting IPs`}</a>{`.\n`}{`[block:api-header]`}{`\n{\n\"title\": \"Testing TLS\"\n}\n`}{`[/block]`}{`\nOf note, PagerDuty Agent comes bundled with its own copy of the public server certificate, which it uses when it connects to validate the connection to the PagerDuty Events API.\n`}{`[block:callout]`}{`\n{\n\"type\": \"warning\",\n\"title\": \"Supported Protocols and the Server Certificate\",\n\"body\": \"PagerDuty as of this writing only supports protocols `}<strong parentName=\"p\">{`TLSv1.2`}</strong>{`. Older protocols (i.e. SSLv3) are widely considered to not be secure and thus are not supported. Traffic using older protocols and versions of TLS will be dropped.\"\n}\n`}{`[/block]`}{`\n`}<strong parentName=\"p\">{`For the security-conscious:`}</strong>{` to get extra certainty, one can check to see if a TLS connection can be established:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`openssl s_client -host events.pagerduty.com -port 443\n`}</code></pre>\n    <p>{`You should see messages indicating a successful connection / TLS handshake, including the following certificate chain:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`Certificate chain\n 0 s:/OU=GT12858685/OU=See www.rapidssl.com/resources/cps (c)14/OU=Domain Control Validated - RapidSSL(R)/CN=*.pagerduty.com\n   i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\n 1 s:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA - G3\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\n 2 s:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\n   i:/C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\n`}</code></pre>\n    <p>{`If you get a TLS handshake error, it may be the case that the GeoTrust root CA certificate isn't trusted on your system.`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://www.geotrust.com/resources/root-certificates/\"\n      }}>{`https://www.geotrust.com/resources/root-certificates/`}</a></p>\n    <p>{`In most distributions of Linux, the  `}<inlineCode parentName=\"p\">{`ca-certificates`}</inlineCode>{` utility can be used for managing trusted certificates.\n`}{`[block:api-header]`}{`\n{\n\"title\": \"Proxy Troubleshooting\"\n}\n`}{`[/block]`}{`\nOne issue that can be tricky to get past is proxy configuration. If web requests are not going through the proxy, or not going anywhere, do you know whether your system is running the daemon without the proper environment variables set, or if there's an issue with connecting to the proxy server (i.e. LAN restrictions)?`}</p>\n    <p>{`[block:callout]`}{`\n{\n\"type\": \"info\",\n\"body\": \"For instructions on how to set up PagerDuty Agent to use a proxy server, refer to the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide#Proxy\"\n      }}>{`PagerDuty Agent installation guide`}</a>{`.\"\n}\n`}{`[/block]`}</p>\n    <h2 {...{\n      \"id\": \"network-issues-maybe\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#network-issues-maybe\",\n        \"aria-label\": \"network issues maybe permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Network Issues Maybe?`}</h2>\n    <p>{`Before any of the following, it's a good idea to check that the proxy server can be reached using standard networking tools. If the hostname is `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`proxy.local`}</inlineCode></strong>{` and the port is `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`8118`}</inlineCode></strong>{`, the commands to do this will be similar to the basic troubleshooting steps in the previous section:`}</p>\n    <ol>\n      <li parentName=\"ol\"><strong parentName=\"li\"><inlineCode parentName=\"strong\">{`ping proxy.local`}</inlineCode></strong>{` to see if it can be reached`}</li>\n      <li parentName=\"ol\"><strong parentName=\"li\"><inlineCode parentName=\"strong\">{`dig proxy.local`}</inlineCode></strong>{` or `}<strong parentName=\"li\"><inlineCode parentName=\"strong\">{`host proxy.local`}</inlineCode></strong>{` to see if the hostname resolves`}</li>\n      <li parentName=\"ol\"><strong parentName=\"li\"><inlineCode parentName=\"strong\">{`nc -v proxy.local 8118`}</inlineCode></strong>{` to check that the port is open and can be connected to`}</li>\n      <li parentName=\"ol\">{`Finally, try using `}<inlineCode parentName=\"li\">{`curl`}</inlineCode>{` to connect through the proxy to the events API's agent heartbeat endpoint. How clients authenticate through the proxy may vary, and other settings may be needed, so you will need to specify extended proxy options; see the documentation for this under `}<strong parentName=\"li\"><inlineCode parentName=\"strong\">{`man curl`}</inlineCode></strong></li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`curl -proxy proxy.local:8118 [additional proxy options] https://api.pagerduty.com/agent/2014-03-14/heartbeat\n`}</code></pre>\n    <p>{`If all goes well, you should receive a response that looks like `}<inlineCode parentName=\"p\">{`{\"heartbeat_interval_secs\":86400}`}</inlineCode></p>\n    <h2 {...{\n      \"id\": \"environment-variables\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#environment-variables\",\n        \"aria-label\": \"environment variables permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Environment Variables?`}</h2>\n    <p>{`The thread that actually performs the sending of events to PagerDuty is the daemon, and for it to use the proxy requires environment variables. To elucidate, the underlying Python library used to make the HTTPS connection is `}<inlineCode parentName=\"p\">{`urllib2`}</inlineCode>{`. Per the `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.python.org/2/library/urllib2.html#urllib2.urlopen\"\n      }}>{`documentation on urllib2.urlopen`}</a>{`:`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`In addition, if proxy settings are detected (for example, when a `}<inlineCode parentName=\"p\">{`*_proxy`}</inlineCode>{` environment variable like `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`http_proxy`}</inlineCode></strong>{` is set), `}<a parentName=\"p\" {...{\n          \"href\": \"https://docs.python.org/2/library/urllib2.html#urllib2.ProxyHandler\"\n        }}><inlineCode parentName=\"a\">{`ProxyHandler`}</inlineCode></a>{` is default installed and makes sure the requests are handled through the proxy.`}</p>\n    </blockquote>\n    <p>{`Under \"Using a Proxy\" in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.pagerduty.com/docs/guides/agent-install-guide/\"\n      }}>{`Agent Install Guide`}</a>{`, two ways of configuring the environment variables for the daemon are described: systemd-based versus SysV init-based Linux systems. You can find out which of these your system uses by running `}<inlineCode parentName=\"p\">{`sudo stat /proc/1/exe`}</inlineCode>{`, which will show you the executable associated with the PID=1 process.`}</p>\n    <p>{`Once you've made sure that the daemon is configured with the environment variables using the correct method, you will need to make sure the changes are applied, which may vary based on your system. In `}<inlineCode parentName=\"p\">{`systemd`}</inlineCode>{` based systems, you will be prompted to run `}<inlineCode parentName=\"p\">{`systemctl daemon-reload`}</inlineCode>{` when you restart service `}<inlineCode parentName=\"p\">{`pdagent`}</inlineCode>{` after modifying the service configuration, after which the service should be restarted once more for the changes to finally take effect.`}</p>\n    <h2 {...{\n      \"id\": \"still-stuck\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#still-stuck\",\n        \"aria-label\": \"still stuck permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Still Stuck?`}</h2>\n    <p>{`As a last resort, failing all other troubleshooting, you can see the actual environment variables that the daemon is running with by adding a logging statement to the agent's component module `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/PagerDuty/pdagent/blob/master/pdagent/sendevent.py\"\n      }}><inlineCode parentName=\"a\">{`sendevent`}</inlineCode></a>{`. On most Linux systems this will be in `}<inlineCode parentName=\"p\">{`/lib/python2.7/site-packages/pdagent/`}</inlineCode>{`, and the method to alter is the method `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`SendEventTask.send_event`}</inlineCode></strong>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`def send_event(self, json_event_str, event_id):\n    import os; logger.info(str(os.environ)) # add this line\n`}</code></pre>\n    <p>{`After making the change, restart pdagent and try sending a test event using `}<inlineCode parentName=\"p\">{`pd-send`}</inlineCode>{`. After that, you'll find a message in the log that that looks like this:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`2017-05-08 18:29:31,556 INFO    SendEventTask        pdagent.sendevent    {'TERM': 'xterm-256color', 'SHELL': '/bin/bash', 'SHLVL': '2', 'SYSTEMCTL_SKIP_REDIRECT': '', 'PWD': '/', 'LOGNAME': 'pdagent', 'USER': 'pdagent', 'HOME': '/home/pdagent', 'SYSTEMCTL_IGNORE_DEPENDENCIES': '', 'PATH': '/sbin:/usr/sbin:/bin:/usr/bin', 'XDG_SESSION_ID': '1', '_': '/usr/share/pdagent/bin/pdagentd.py'}\n`}</code></pre>\n    <p>{`If the environment variables were set, they would have shown up in the print-out of the `}<inlineCode parentName=\"p\">{`os.environ`}</inlineCode>{` dictionary, i.e. `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`'http_proxy': 'http://proxy.local:8118'`}</inlineCode></strong>{` and `}<strong parentName=\"p\"><inlineCode parentName=\"strong\">{`'https_proxy': 'https://proxy.local:8118'`}</inlineCode></strong>{`, which (note) are missing in the above line.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}